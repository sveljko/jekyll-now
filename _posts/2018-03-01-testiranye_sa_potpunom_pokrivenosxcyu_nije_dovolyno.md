---
layout: post
title: Тестирање са потпуном покривеношћу није довољно
lang: sr
---

Покривеност је корисна метрика тестирања, али, није _циљ_. Коде
може да има 100% покривеност, па ипак има буба и може да има 0%
покривеност а нема ниједну једину бубу.

## 100% покривен код са бубом

У модулу који је имао 100'% покривцености, како редова кода, тако
и грана, постојала је прилично озбиљна буба.

Модул се бавио листама временских контрола (ВК), у виду двоструког
повезаних листи. Сваки члан носи податак "колико тикова треба да
прође од истека претходног члана док ми не истекнемо". Ово чини
обраду листа ВК прилично ефикасном. "Тик" је јединица мере времена
у датој примени (ms је честа).

Буба је проста - ако укидамо ВК, дакле изланчавамо је из лист,
а она је _прва_ у листи (следећа да истекне), то није обрађивано
исправно. Време да та ВК истекне _није_ додавано на време за
следећу ВК.

Ради илустрације, претпоставимо да има две ВК, обе покренуте да
трају 100 тикова, али, са једним тиком размака. Дакле, по покретању,
лист је изгледала овако:

    T1(100) -> T2(1)

Након што је прошло неких 40 тикова, листа би била:

    T1(60) -> T2(1)

Онда је Т1 укинута, па би листа била:

    T2(61)
	
Али, због бубе, лист је у ствари била:

    T2(1)

Постојала је грана која изричито обрађује овај случај. Али,
код који додаје "време до истека" просто није постојао. Ради
се о Ц-у, а ред кода који је недостајао је био:

    list->timeout_left_ms += to_remove->timeout_left_ms;

## Зашто ("потпуни") тестови ово нису ухватили?

Тестови _јесу_ тестирали избацивање првог члана листе. Али, пошто је
`timeout_left_ms` унутрашња ствар модула, тестови то нису проверавали.
Такође, нису проверавали ни "шта ко прође неко време након избацивања".
У нашем случају, ако после избацивања прође 40 тикова, Т2 _не_ треба
да истекне (али у ствари јесте истицао).

Очигледно, овај прост сценарио није уочен при тестирању, него је свака
могућност модула независно тестирана. Тестови за укидање су тестирали
само изланчавање. Тестови за "пролазак времена" су тестирали само
време. Бубе се врло често крију у сценаријима који обухватају више
могућности.


## Наравоученије

За високо квалитетне тестове, треба увидети сценарије упторебе и 
тестирати их (све, по могућству). Управо _не_ треба размишљати
о покривености кода. Штавише, висока покривеност _не_ треба да буде
циљ. Не желимо да "покријемо" код, већ желимо да га _тестирамо_.
Мера покривености је само врста "назнаке" - ако је покривеност
ниска, вероватно тестови нису баш најбољи.
